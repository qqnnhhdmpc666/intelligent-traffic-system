# 路口车流识别系统配置文件

# 系统基本信息
system:
  name: "TrafficVisionSystem"
  version: "1.0.0"
  intersection_id: "raspi-2024"         # 使用原项目token作为路口ID
  location: "Test Intersection"        # 路口位置描述
  timezone: "Asia/Shanghai"            # 时区设置

# 服务器连接配置
server:
  host: "120.53.28.58"
  port: 3389
  base_url: "http://120.53.28.58:3389"
  api_endpoints:
    traffic_update: "/api/traffic_update"
    health_check: "/health"
    system_stats: "/api/system_stats"

  # 连接参数
  timeout: 30                          # 请求超时时间（秒）
  retry_attempts: 3                    # 重试次数
  retry_delay: 5                       # 重试间隔（秒）

  # 数据上报频率
  report_interval: 10                  # 数据上报间隔（秒）
  batch_size: 100                      # 批量上报大小

# 摄像头配置
camera:
  # 摄像头类型: 'picamera' 或 'usb' 或 'rtsp'
  type: "picamera"

  # 分辨率设置 (与原项目保持一致)
  width: 640
  height: 480
  fps: 30

  # 摄像头参数
  brightness: 50                       # 亮度 (0-100)
  contrast: 50                         # 对比度 (0-100)
  saturation: 50                       # 饱和度 (0-100)

  # USB摄像头设置（如果使用USB摄像头）
  usb_device_id: 0

  # RTSP流设置（如果使用网络摄像头）
  rtsp_url: "rtsp://admin:password@192.168.1.100:554/stream"

  # 录制设置
  enable_recording: false              # 是否启用录制
  recording_duration: 300              # 录制时长（秒）
  recording_path: "./data/recordings"  # 录制文件保存路径

# YOLOv8检测配置
detection:
  # 模型设置
  model_path: "./models/yolov8n.pt"    # 模型文件路径
  model_type: "yolov8n"                # 模型类型
  device: "cpu"                        # 设备类型: 'cpu' 或 'cuda'
  
  # 检测参数
  confidence_threshold: 0.5            # 置信度阈值
  iou_threshold: 0.45                  # IoU阈值
  max_detections: 100                  # 最大检测数量
  
  # 目标类别（COCO数据集）
  target_classes:
    - 2   # car
    - 3   # motorcycle  
    - 5   # bus
    - 7   # truck
  
  # 检测区域设置 (简化为与原项目兼容的南北方向计数)
  detection_zones:
    - name: "north_lane"
      polygon: [[0, 0], [640, 0], [640, 240], [0, 240]]
    - name: "south_lane"
      polygon: [[0, 240], [640, 240], [640, 480], [0, 480]]

# 车流统计配置
traffic_analysis:
  # 统计参数
  counting_line_thickness: 3           # 计数线粗细
  vehicle_min_area: 1000               # 车辆最小面积
  vehicle_max_area: 50000              # 车辆最大面积
  
  # 跟踪参数
  max_tracking_distance: 50           # 最大跟踪距离
  max_tracking_frames: 30             # 最大跟踪帧数
  min_tracking_confidence: 0.3        # 最小跟踪置信度
  
  # 统计时间窗口
  statistics_window: 60               # 统计时间窗口（秒）
  history_length: 3600                # 历史数据保留时长（秒）

# 日志配置
logging:
  level: "INFO"                       # 日志级别: DEBUG, INFO, WARNING, ERROR
  log_dir: "./logs"                   # 日志目录
  max_file_size: "10MB"               # 单个日志文件最大大小
  backup_count: 5                     # 日志文件备份数量
  log_format: "{time:YYYY-MM-DD HH:mm:ss} | {level} | {name}:{function}:{line} | {message}"
  
  # 日志输出
  console_output: true                # 是否输出到控制台
  file_output: true                   # 是否输出到文件
  
  # 模块日志级别
  modules:
    detection: "INFO"
    tracking: "INFO"
    communication: "INFO"
    system: "DEBUG"

# 性能配置
performance:
  # 处理线程数
  detection_threads: 2                # 检测线程数
  tracking_threads: 1                 # 跟踪线程数
  communication_threads: 1            # 通信线程数
  
  # 内存管理
  max_memory_usage: 80                # 最大内存使用率（%）
  garbage_collection_interval: 300   # 垃圾回收间隔（秒）
  
  # 帧处理
  frame_skip: 1                       # 跳帧数（1表示不跳帧）
  max_queue_size: 10                  # 最大队列大小

# 监控配置
monitoring:
  # 系统监控
  enable_system_monitor: true         # 启用系统监控
  monitor_interval: 30                # 监控间隔（秒）
  
  # 性能指标
  track_fps: true                     # 跟踪FPS
  track_memory: true                  # 跟踪内存使用
  track_cpu: true                     # 跟踪CPU使用
  track_temperature: true             # 跟踪温度（树莓派）
  
  # 告警阈值
  alerts:
    high_cpu_threshold: 80            # CPU使用率告警阈值（%）
    high_memory_threshold: 85         # 内存使用率告警阈值（%）
    high_temperature_threshold: 70    # 温度告警阈值（°C）
    low_fps_threshold: 15             # FPS过低告警阈值

# 调试配置
debug:
  enable_debug_mode: false            # 启用调试模式
  save_debug_images: false            # 保存调试图像
  debug_image_path: "./data/debug"    # 调试图像保存路径
  show_detection_boxes: true          # 显示检测框
  show_tracking_trails: true          # 显示跟踪轨迹
  show_counting_lines: true           # 显示计数线
  
  # 可视化设置
  visualization:
    enable_display: false             # 启用显示（需要显示器）
    display_width: 1280               # 显示宽度
    display_height: 720               # 显示高度
    update_interval: 100              # 显示更新间隔（毫秒）

